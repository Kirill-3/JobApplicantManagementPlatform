<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Applicant Profile</title>
    <link rel="stylesheet" href="/styling/IndividualProfiles.css">
    <link th:replace="fragments/header :: bootstrap-css"/>
    <link rel="stylesheet" type="text/css" href="/css/profilePageStyling.css"/>
    <script src="/javaScript/profilePageJS.js"></script>
    <script th:inline="javascript">
        const alertMessage = /*[[${alertMessage}]]*/ 'default message';
        if (alertMessage && alertMessage !== 'default message') {
            alert(alertMessage);
        }
    </script>
</head>
<body>

<div th:replace="~{fragments/header :: header}"/>

<div class="search-bar-container" th:if="${profile == null}">
    <form th:action="@{/profile/search}" method="get">
        <input type="text" name="query" placeholder="Search profiles...">
        <button type="submit">Search</button>
        <select id="statusDropdown" class="statusDropdown">
            <option value="">All Statuses</option>
            <option value="Internal">Internal</option>
            <option value="External">External</option>
        </select>


    </form>
</div>
<div th:if="${profile == null}" >
<div class="tableContainer">
    <table id="table1" class="tableClickable">
        <thead>
        <tr>
            <th th:data-type="firstName">First Name</th>
            <th th:data-type="lastName">Last Name</th>
            <th th:data-original-text="Location">
                <select id="locationDropdown" class="thisDropdown">
                    <option value="" >All Locations</option>
                    <option th:each="location : ${uniqueLocations}" th:value="${location.getLocation()}" th:text="${location.getLocation()}" ></option>
                </select>
            </th >
            <th th:data-original-text="event">
                <select id="eventDropdown" class="thisDropdown">
                    <option value="">All events</option>
                    <option th:each="event : ${uniqueEvents}" th:value="${event.getEventAttended()}" th:text="${event.getEventAttended()}"></option>
                </select>
            </th>
            <th>
                <select id="skillDropdown" class="thisDropdown">
                    <option value="">All Skills</option>
                    <option th:each="skill : ${uniqueSkills}" th:value="${skill}" th:text="${skill}"></option>
                </select>
            </th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="profile : ${profileList}" th:data-href="@{/profile/{id}(id=${profile.getId()})}" th:data-location="${profile.getLocation()}" th:data-firstName="${profile.getFirstName()}" th:data-lastName="${profile.getLastName()}" th:data-event="${profile.getEventAttended()}" th:data-skill="${profile.getSkill()}" th:data-status="${profile.jobDetails.getStatus()}">
            <td th:text="${profile.getFirstName()}"></td>
            <td th:text="${profile.getLastName()}"></td>
            <td th:text="${profile.getLocation()}"></td>
            <td th:text="${profile.getEventAttended()}"></td>
            <td th:text="${profile.getSkill()}"></td>
        </tr>
        </tbody>
    </table>
</div>
</div>

<br>
<div th:if="${profile != null}" class="profile-container">

    <button id="editButton" onclick="showEditForm()">Edit</button>

    <div id="editForm" style="display:none;">
        <form th:action="@{/profile/edit/{userID}(userID=${profile.getId()})}" method="post">
            <!-- Existing fields -->
            <label for="firstName">First Name:</label>
            <input type="text" id="firstName" name="firstName" th:value="${profile.firstName}" required>
            <br>
            <label for="lastName">Last Name:</label>
            <input type="text" id="lastName" name="lastName" th:value="${profile.lastName}" required>
            <br>
            <label for="location">Location:</label>
            <input type="text" id="location" name="location" th:value="${profile.location}" required>
            <br>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" th:value="${profile.email}" required>
            <br>
            <label for="phoneNumber">Phone Number:</label>
            <input type="text" id="phoneNumber" name="phoneNumber" th:value="${profile.phoneNumber}" required oninput="validateUKPhoneNumber(this)">
            <br>
            <label for="currentPosition">Current Position:</label>
            <input type="text" id="currentPosition" name="currentPosition" th:value="${profile.jobDetails?.currentPosition}" required>
            <br>
            <label for="status">Status:</label>
            <input type="text" id="status" name="status" th:value="${profile.jobDetails?.status}" required oninput="validateStatus(this)">
            <br>
            <label for="skill">Skills:</label>
            <input type="text" id="skill" name="skill" th:value="${profile.skill}" required>
            <br>
            <label for="eventAttended">Event Attended:</label>
            <input type="text" id="eventAttended" name="eventAttended" th:value="${profile.eventAttended}" required>
            <br>
            <label for="subscribeToNewsletter">Subscribe to Newsletter:</label>
            <input type="checkbox" id="subscribeToNewsletter" name="subscribeToNewsletter" th:checked="${profile.preferences?.subscribeToNewsletter}">
            <br>
            <label for="subscribeToBulletins">Subscribe to Bulletins:</label>
            <input type="checkbox" id="subscribeToBulletins" name="subscribeToBulletins" th:checked="${profile.preferences?.subscribeToBulletins}">
            <br>
            <label for="subscribeToJobUpdates">Subscribe to Job Updates:</label>
            <input type="checkbox" id="subscribeToJobUpdates" name="subscribeToJobUpdates" th:checked="${profile.preferences?.subscribeToJobUpdates}">
            <br>
            <button type="submit">Save</button>
        </form>
    </div>
    <br>

    <div class="profile-details">
        <h2>Personal Details</h2>
        <table class="tableApplicant">
            <tr>
                <th>First Name</th>
                <td th:text="${profile.firstName}"></td>
            </tr>
            <tr>
                <th>Last Name</th>
                <td th:text="${profile.lastName}"></td>
            </tr>
            <tr>
                <th>Location</th>
                <td th:text="${profile.location}"></td>
            </tr>
            <tr>
                <th>Email</th>
                <td th:text="${profile.email}"></td>
            </tr>
            <tr>
                <th>Phone Number</th>
                <td th:text="${profile.phoneNumber != null ? profile.phoneNumber : 'N/A'}"></td>
            </tr>
        </table>
        <br>

        <h2>Applicant Experience</h2>
        <table class="tableApplicant">
            <tr>
                <th>Current Position</th>
                <td th:text="${profile.jobDetails?.currentPosition != null ? profile.jobDetails.currentPosition : 'N/A'}"></td>
            </tr>
            <tr>
                <th>Status</th>
                <td th:text="${profile.jobDetails?.status != null ? profile.jobDetails.status : 'N/A'}"></td>
            </tr>
            <tr>
                <th>Skills</th>
                <td th:text="${profile.skill != null ? profile.skill : 'N/A'}"></td>
            </tr>
            <tr>
                <th>Event Attended</th>
                <td th:text="${profile.eventAttended}"></td>
            </tr>
        </table>

        <br>

        <h2>Applicant Preferences</h2>

        <table class="tableApplicant">
            <tr>
                <th>Subscribed to newsletter?</th>
                <td th:text="${profile.preferences?.subscribeToNewsletter} ? 'Yes' : 'No'"></td>
            </tr>
            <tr>
                <th>Subscribed to bulletins?</th>
                <td th:text="${profile.preferences?.subscribeToBulletins} ? 'Yes' : 'No'"></td>
            </tr>
            <tr>
                <th>Subscribed to job updates?</th>
                <td th:text="${profile.preferences?.subscribeToJobUpdates} ? 'Yes' : 'No'"></td>
            </tr>
        </table>

        <br>
        <form th:if="${profile != null}" th:action="@{/profile/sendEmail/{userID}(userID=${profile.getId()})}" method="post" onsubmit="showAlert()">
            <button type="submit"> Email <span th:text="${profile.firstName}"></span></button>
        </form>
        <br>

        <a th:href="@{/profile}">Back to Profiles</a>

    </div>

    <div class="resume-section">
        <h2>Applicant CV/Resume</h2>
        <form th:action="@{/profile/uploadCV/{userID}(userID=${profile.getId()})}" method="post" enctype="multipart/form-data">
            <label for="cvUpload">Select CV (PDF only):</label>
            <input type="file" id="cvUpload" name="cvUpload" accept="application/pdf" required>
            <button type="submit">Upload CV</button>
        </form>

        <p th:text="${message}"></p>

        <!-- Check if CV exists and display it -->
        <div th:if="${cvBase64 != null}">
            <h3>Uploaded CV</h3>
            <!-- Embed the uploaded CV PDF using base64 encoding -->
            <iframe th:src="'data:application/pdf;base64,' + ${cvBase64}" width="100%" height="600px" style="border: none;"></iframe>
        </div>
    </div>
</div>

<!-- Footer -->
<div th:replace="~{fragments/footer :: footer-links}"></div>
<div th:replace="~{fragments/footer :: bootstrap-js}"></div>
</body>
</html>